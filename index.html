<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âœˆï¸2026è¶Šå—7å¤©6å¤œâœˆï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f3f4f6;
            color: #333;
            overscroll-behavior-y: none;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe-top { padding-top: max(env(safe-area-inset-top), 1rem); }
        .tab-content { display: none; opacity: 0; transition: opacity 0.2s ease-in-out; }
        .tab-content.active { display: block; opacity: 1; }
        
        /* æ–‡å­—å±•é–‹æ”¶åˆæ¨£å¼ */
        .desc-text {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            white-space: pre-wrap;
            transition: all 0.3s ease;
        }
        .desc-text.expanded {
            -webkit-line-clamp: unset;
        }
        
        /* æ™‚é–“è»¸ç·šæ¢ */
        .timeline-line {
            position: absolute;
            left: 27px;
            top: 3.5rem;
            bottom: -1rem;
            width: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }

        /* è¨ˆç®—æ©Ÿ Modal å‹•ç•« */
        #calc-modal { transition: opacity 0.3s ease, visibility 0.3s ease; }
        #calc-modal.hidden-modal { opacity: 0; visibility: hidden; pointer-events: none; }
        #calc-modal.show-modal { opacity: 1; visibility: visible; pointer-events: auto; }
        #calc-content { transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .hidden-modal #calc-content { transform: scale(0.9) translateY(20px); }
        .show-modal #calc-content { transform: scale(1) translateY(0); }
        
        /* çµç®—å€å¡Šå‹•ç•« */
        #settlement-details { transition: max-height 0.3s ease-out, opacity 0.3s ease; overflow: hidden; max-height: 0; opacity: 0; }
        #settlement-details.open { max-height: 500px; opacity: 1; }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden max-w-md mx-auto bg-gray-50 shadow-2xl relative">

    <header class="bg-teal-700 text-white px-5 pt-safe-top pb-4 shadow-md z-50 shrink-0 relative">
        <div class="flex justify-between items-center pt-2">
            <div>
                <h1 class="text-xl font-bold tracking-tight">2026 å³´æ¸¯ 7å¤©6å¤œ</h1>
                <p class="text-teal-100 text-sm opacity-90 mt-1">1/29 (å››) - 2/4 (ä¸‰)</p>
            </div>
        </div>
    </header>

    <main id="app-container" class="flex-1 overflow-y-auto relative bg-gray-50 pb-24">
        <div id="loading-msg" class="p-10 text-center text-gray-500">
            è³‡æ–™è¼‰å…¥ä¸­...
        </div>
        
        <div id="view-itinerary" class="tab-content active">
            <div class="sticky top-0 z-40 bg-white/95 backdrop-blur-sm border-b border-gray-200 py-3 shadow-sm">
                <div id="day-selector" class="flex px-4 gap-3 overflow-x-auto hide-scrollbar"></div>
            </div>
            <div id="itinerary-list" class="p-4 space-y-4"></div>
        </div>

        <div id="view-mustbuy" class="tab-content p-5 space-y-4">
            <div class="bg-teal-50 border-l-4 border-teal-500 p-4 mb-4 rounded-r">
                <p class="text-sm text-teal-700 font-bold">ğŸ›’ è³¼ç‰©å°è²¼å£«</p>
                <p class="text-xs text-teal-600 mt-1">å»ºè­°åœ¨æ¼¢å¸‚å ´æˆ– Lotte Mart è³¼è²·ï¼Œè¨˜å¾—è²¨æ¯”ä¸‰å®¶ä¸¦é©åº¦æ®ºåƒ¹ã€‚</p>
            </div>
            <div id="mustbuy-list" class="space-y-6"></div>
        </div>

        <div id="view-accounting" class="tab-content p-5 space-y-4">
            
            <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 mb-6 relative transition-all duration-300" id="form-card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2" id="form-title">
                        ğŸ’¸ æ–°å¢ä¸€ç­†å¸³ç›®
                    </h2>
                    <button id="btn-cancel-edit" onclick="resetFormState()" class="hidden text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full font-bold">
                        âœ• å–æ¶ˆ
                    </button>
                </div>

                <form id="account-form" class="space-y-4" onsubmit="submitExpense(event)">
                    <input type="hidden" id="edit-row-id" value="">

                    <div class="grid grid-cols-2 gap-3">
                         <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">æ—¥æœŸ</label>
                            <input type="date" id="acc-date" required class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">ä»˜æ¬¾äºº</label>
                            <select id="acc-payer" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="æ¦®">æ¦®</option>
                                <option value="å¦‚">å¦‚</option>
                                <option value="ç¿”">ç¿”</option>
                                <option value="åº­">åº­</option>
                                <option value="ä¸­">ä¸­</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">é …ç›®åç¨±</label>
                        <input type="text" id="acc-item" required placeholder="ä¾‹å¦‚ï¼šåˆé¤ã€è¨ˆç¨‹è»Š" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500">
                    </div>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="col-span-1">
                            <label class="block text-xs font-bold text-gray-500 mb-1">å¹£åˆ¥</label>
                            <select id="acc-currency" onchange="updateRateDisplay()" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500">
                                <option value="VND">ğŸ‡»ğŸ‡³ è¶Šç›¾</option>
                                <option value="TWD">ğŸ‡¹ğŸ‡¼ å°å¹£</option>
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="block text-xs font-bold text-gray-500 mb-1">é‡‘é¡</label>
                            <input type="number" id="acc-amount" required placeholder="è¼¸å…¥æ•¸å­—" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-lg font-bold text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500">
                        </div>
                    </div>
                    <p id="acc-rate-hint" class="text-xs text-gray-400 -mt-2 text-right">æ­£åœ¨è®€å–åŒ¯ç‡...</p>
                    
                    <div>
                         <label class="block text-xs font-bold text-gray-500 mb-1">å‚™è¨» (é¸å¡«)</label>
                         <input type="text" id="acc-note" placeholder="è©³ç´°èªªæ˜..." class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500">
                    </div>
                    
                    <button type="submit" id="btn-submit-acc" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-xl shadow-md transition-all active:scale-95 flex justify-center items-center gap-2">
                        <span>è¨˜å¸³</span>
                    </button>
                </form>
            </div>

            <div id="expense-summary-card" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-4 hidden">
                <div class="flex justify-between items-center mb-1">
                    <p class="text-xs text-gray-500 font-bold">ç¸½æ”¯å‡º (Total)</p>
                    <div class="flex gap-2">
                        <button onclick="fetchExpenses()" class="text-[10px] text-teal-600 font-bold bg-teal-50 px-2 py-1 rounded-full">â†» æ›´æ–°</button>
                    </div>
                </div>
                <div class="flex justify-between items-end border-b border-gray-100 pb-4 mb-3">
                    <p class="text-3xl font-black text-teal-700" id="total-expense">0</p>
                    <button onclick="toggleSettlement()" id="btn-toggle-settlement" class="text-xs text-blue-600 font-bold flex items-center gap-1 hover:bg-blue-50 px-2 py-1 rounded transition-colors">
                        <span>æŸ¥çœ‹çµç®—</span>
                        <svg class="w-3 h-3 transform transition-transform duration-200" id="arrow-settlement" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                </div>

                <div id="settlement-details" class="space-y-3 text-sm">
                    <div class="bg-gray-50 p-3 rounded-lg text-xs text-gray-500 mb-2">
                        <p>ğŸ’¡ è² æ•¸(<span class="text-green-600 font-bold">ç¶ è‰²</span>)ä»£è¡¨æ­¤äººä»£å¢Šå¤ªå¤šï¼Œæ‡‰æ‹¿å›æ¬¾é …ï¼›æ­£æ•¸(<span class="text-rose-500 font-bold">ç´…è‰²</span>)ä»£è¡¨æ‡‰æ”¯ä»˜æ¬¾é …ã€‚</p>
                    </div>
                    <div class="space-y-3" id="split-result-list">
                        </div>
                </div>
            </div>

            <div>
                <h3 class="font-bold text-gray-700 mb-3 px-1">æ¶ˆè²»æ˜ç´°</h3>
                <div id="expense-list" class="space-y-3 pb-10">
                    <div class="text-center text-gray-400 py-4 text-sm">è¼‰å…¥ä¸­...</div>
                </div>
            </div>
        </div>

        <div id="view-flights" class="tab-content p-5 space-y-4"></div>

        <div id="view-hotels" class="tab-content p-5 space-y-4"></div>
    </main>

    <button onclick="toggleCalc()" class="fixed bottom-24 right-5 z-40 bg-rose-500 hover:bg-rose-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-transform hover:scale-105 active:scale-95">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
    </button>

    <div id="calc-modal" class="fixed inset-0 z-[60] flex items-center justify-center px-4 hidden-modal">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleCalc()"></div>
        <div id="calc-content" class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden relative z-10">
            <div class="bg-teal-600 p-4 text-white flex justify-between items-center">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    ğŸ’± åŒ¯ç‡æ›ç®—
                    <span id="rate-status" class="text-[10px] bg-teal-800 px-2 py-0.5 rounded-full font-normal opacity-80">æ›´æ–°ä¸­...</span>
                </h3>
                <button onclick="toggleCalc()" class="text-white/80 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 space-y-6">
                <div class="text-center text-sm text-gray-500 mb-2">
                    ç•¶å‰åŒ¯ç‡ï¼š1 TWD â‰ˆ <span id="display-rate" class="font-bold text-teal-600 text-lg">---</span> VND
                </div>

                <div class="space-y-4">
                    <div class="relative">
                        <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">ğŸ‡»ğŸ‡³ è¶Šå—ç›¾ (VND)</label>
                        <input type="number" id="input-vnd" placeholder="è¼¸å…¥é‡‘é¡" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-lg font-bold text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:bg-white transition-all">
                        <span class="absolute right-4 top-[2.1rem] text-gray-400 text-sm font-bold">â‚«</span>
                    </div>
                    
                    <div class="flex justify-center -my-2 relative z-10">
                        <div class="bg-gray-100 p-2 rounded-full text-gray-400">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path></svg>
                        </div>
                    </div>

                    <div class="relative">
                        <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">ğŸ‡¹ğŸ‡¼ æ–°å°å¹£ (TWD)</label>
                        <input type="number" id="input-twd" placeholder="è¼¸å…¥é‡‘é¡" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-lg font-bold text-gray-800 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:bg-white transition-all">
                        <span class="absolute right-4 top-[2.1rem] text-gray-400 text-sm font-bold">$</span>
                    </div>
                </div>
                
                <div class="text-xs text-gray-400 text-center mt-4">
                    * åŒ¯ç‡åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è«‹ä»¥æ›åŒ¯åº—å®¶ç‚ºæº–
                </div>
            </div>
        </div>
    </div>

    <nav class="bg-white border-t border-gray-200 shrink-0 pb-safe z-50 fixed bottom-0 w-full max-w-md">
        <div class="grid grid-cols-5 h-16">
            <button onclick="switchTab('itinerary')" id="btn-itinerary" class="nav-btn flex flex-col items-center justify-center w-full h-full text-teal-600">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                <span class="text-[10px] font-medium mt-1">è¡Œç¨‹</span>
            </button>
            <button onclick="switchTab('flights')" id="btn-flights" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                <span class="text-[10px] font-medium mt-1">ç­æ©Ÿ</span>
            </button>
            
            <button onclick="switchTab('hotels')" id="btn-hotels" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m8-2a2 2 0 100-4 2 2 0 000 4zm-6-4a2 2 0 110-4 2 2 0 010 4zm6-10a2 2 0 110-4 2 2 0 010 4zm-6 4a2 2 0 110-4 2 2 0 010 4z"></path></svg>
                <span class="text-[10px] font-medium mt-1">ä½å®¿</span>
            </button>
            <button onclick="switchTab('mustbuy')" id="btn-mustbuy" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                <span class="text-[10px] font-medium mt-1">å¿…è²·</span>
            </button>
            <button onclick="switchTab('accounting')" id="btn-accounting" class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span class="text-[10px] font-medium mt-1">åˆ†å¸³</span>
            </button>
        </div>
    </nav>

    <script>
        // ==========================================
        // âš ï¸ Google Apps Script ç¶²å€
        // ==========================================
        const GAS_URL = "https://script.google.com/macros/s/AKfycbxkMih0wCDogTrbg4zPUgWqpJ4S8gSBi94Vpn_AROib15BhNiPyZowkNpeFnGpl0L_DqA/exec"; 

        const DATA = {
            shopping: [
                { 
                    name: "é‡‘é¾ç¶ è±†ç³•", 
                    image: "é‡‘é¾ç¶ è±†ç³•.jpg",
                    desc: "ç¶ è±†ç³•æ˜¯çŸ¥åçš„è¶Šå—ç‰¹ç”¢ä¹‹ä¸€ï¼Œå£æ„Ÿç¶¿å¯†ï¼Œé©åˆæ­é…èŒ¶é»ã€‚", 
                    highlight: "ç¶“å…¸ç‰¹ç”¢" 
                },
                { 
                    name: "ç™½è™æ´»çµ¡è†", 
                    image: "ç™½è™æ´»çµ¡è†.jpg",
                    desc: "çŸ¥åçš„æ­¢ç—›è†ï¼Œå¯ä»¥ç·©è§£è…°ç— èƒŒç—›ã€é—œç¯€ç—›ã€æ¶ˆè…«ç­‰ï¼Œæ˜¯é•·è¼©æœ€æ„›çš„ä¼´æ‰‹ç¦®ã€‚", 
                    highlight: "è—¥å±€å¿…è²·" 
                },
                { 
                    name: "å¸¶çš®è…°æœ", 
                    image: "å¸¶çš®è…°æœ.png",
                    desc: "è¶Šå¤§é¡†è¶Šè²´ã€‚å°éŠç‰¹åˆ¥äº¤ä»£ç›¡é‡è²·ã€Œå¸¶çš®çš„ã€ï¼Œå› ç‚ºå»çš®ç‚ºäº†ä¿å­˜å¯èƒ½æœƒæµ¸è—¥æ°´ï¼Œå¸¶çš®çš„è¼ƒå¤©ç„¶ä¸”é¦™æ°£æ›´è¶³ã€‚", 
                    highlight: "å°éŠæ¨è–¦" 
                },
                { 
                    name: "Vinamit é¦™è•‰ä¹¾/ç¶œåˆæœä¹¾", 
                    image: "Vinamitçš„é¦™è•‰ä¹¾.png",
                    desc: "è¶Šå—æ°´æœéå¸¸ç”œï¼Œä¸” Vinamit å¤šä½¿ç”¨å¤©ç„¶ç³–æ¼¿é†ƒè£½ï¼Œä¸å«åŒ–å­¸æ·»åŠ ç‰©ã€‚å£å‘³è±å¯Œå¦‚æ³¢ç¾…èœœã€è”æã€èŠ’æœç­‰ã€‚\nåƒ¹æ ¼è¦ªæ°‘ (ä¸€åŒ…ç´„ NTD 35)ï¼Œæ˜¯ä¾¿å®œåˆå¥½åƒçš„å¿…è²·é›¶é£Ÿã€‚", 
                    highlight: "å¤©ç„¶é›¶é£Ÿ" 
                },
                { 
                    name: "Ohla èŠ’æœä¹¾", 
                    image: "Ohla èŠ’æœä¹¾.jpg",
                    desc: "å£æ„Ÿåšå¯¦Qå½ˆï¼Œä¿ç•™äº†èŠ’æœçš„å¤©ç„¶é¦™æ°£èˆ‡ç”œå‘³ï¼Œæ˜¯è¿‘å¹´ä¾†éå¸¸ç†±é–€çš„ä¼´æ‰‹ç¦®é¸æ“‡ã€‚", 
                    highlight: "äººæ°£æ¨è–¦" 
                },
                { 
                    name: "Haohao æ³¡éºµ", 
                    image: "Haohaoæ³¡éºµ.jpg",
                    desc: "CPå€¼è¶…é«˜ï¼\nğŸ”µ è—è‰²åŒ…è£ (è’œé¦™æ’éª¨)ï¼šå°ç£äººæœ€æ„›ï¼Œä½†å®ƒæ˜¯è±¬è‚‰å£å‘³ã€‚\nğŸ”´ ç²‰è‰²åŒ…è£ (é…¸è¾£è¦)ï¼šç•¶åœ°äººæœ€æ„›ï¼Œé¡ä¼¼ä¾†ä¸€å®¢æµ·é®®å£å‘³çš„åŠ å¼·ç‰ˆã€‚", 
                    highlight: "è¶…å¸‚æƒè²¨" 
                },
                { 
                    name: "MAROU å·§å…‹åŠ›", 
                    image: "MAROUå·§å…‹åŠ›.jpg",
                    desc: "è¶Šå—æœ€æœ‰åçš„ç²¾å“å·§å…‹åŠ›ï¼Œæ¡ç”¨ç•¶åœ°å„ªè³ªå¯å¯è±†ï¼Œè¢«ã€Šç´ç´„æ™‚å ±ã€‹è­½ç‚ºã€Œæœ€æ£’çš„å·§å…‹åŠ›ã€ã€‚åŒ…è£ç²¾ç¾ï¼Œé©åˆé€ç¦®ã€‚", 
                    highlight: "ç²¾å“ç­‰ç´š" 
                },
                { 
                    name: "è¶Šå—æ²³ç²‰æ³¡éºµ (Vifon)", 
                    image: "è¶Šå—æ²³ç²‰æ³¡éºµ.jpg",
                    desc: "æƒ³æŠŠè¶Šå—æ²³ç²‰å¸¶å›å°ç£ï¼Ÿæ¨è–¦ Vifon ç­‰å“ç‰Œçš„å³é£Ÿæ²³ç²‰ (Pho)ï¼Œæ¹¯é ­é‚„åŸåº¦é«˜ï¼Œæœ‰é›è‚‰æˆ–ç‰›è‚‰å£å‘³ï¼Œé€ç¦®è‡ªç”¨å…©ç›¸å®œã€‚", 
                    highlight: "é‚„åŸåº¦é«˜" 
                },
                { 
                    name: "è¥¿å¯§è¦é¹½ (Muá»‘i TÃ´m)", 
                    image: "è¦é¹½.png",
                    desc: "è¶Šå—å—éƒ¨æ–™ç†çš„éˆé­‚ï¼ç”±é¹½å’Œä¹¾ç‡¥è¦ç²‰æ··åˆã€‚è³ªåœ°ç´°è†©ï¼Œå¸¶æœ‰æ¿ƒéƒè¦é¦™ã€‚\nğŸ’¡ ç”¨æ³•ï¼šè˜¸æ°´æœ (é’èŠ’æœã€é³³æ¢¨)ã€ç‚¸ç‰©ã€ç‡’çƒ¤ï¼Œèƒ½å¤§å¹…æå‡é¢¨å‘³å±¤æ¬¡ã€‚", 
                    highlight: "ç¨ç‰¹èª¿å‘³" 
                },
                { 
                    name: "æ‰‹å·¥ç·¨ç¹”åŒ…", 
                    image: "ç·¨ç¹”åŒ….png",
                    desc: "è¶Šå—å¸‚é›†å¸¸è¦‹ï¼Œç·¨ç¹”æŠ€è¡“ç²¾æ¹›ï¼Œæ­é…æµè˜‡ç­‰è£é£¾ã€‚è¼•ç›ˆã€å …å›ºåˆå¯¦ç”¨ï¼Œåƒ¹æ ¼è¦ªæ°‘ (ç´„ NTD 200 èµ·)ï¼Œè³ªæ„Ÿä¸è¼¸ç²¾å“ï¼Œæ˜¯çµ•ä½³çš„ç©¿æ­é…ä»¶ã€‚", 
                    highlight: "é«˜CPå€¼" 
                }
            ],
            flights: [
                { type: "å»ç¨‹", date: "1/29 (å››)", airline: "å°ç£è™èˆª IT 551", time: "17:25 - 19:10", from: "æ¡ƒåœ’æ©Ÿå ´ (T1)", to: "å³´æ¸¯æ©Ÿå ´", note: "æœ‰ä¾›é¤ã€‚\nèµ·é£›å‰ 48h-60m éœ€ç¶²è·¯å ±åˆ°" },
                { type: "å›ç¨‹", date: "2/4 (ä¸‰)", airline: "è¯èˆª CI 788", time: "10:20 - 14:05", from: "å³´æ¸¯æ©Ÿå ´ (T2)", to: "æ¡ƒåœ’æ©Ÿå ´ (T1)", note: "æœ‰ä¾›é¤ã€‚\næ©Ÿå‹ Airbus A321neo" }
            ],
            hotels: [
                { name: "Cozy Danang Boutique Hotel", dates: "1/29 - 2/2 (4æ™š)", location: "å³´æ¸¯å¸‚å€", note: "2*é›™åºŠæˆ¿ + 1*é›™äººæˆ¿ã€‚\nå«æ—©é¤ã€æœ‰æµ´ç¼¸ã€é ‚æ¨“æ³³æ±  (2022é–‹å¹•)ã€‚", mapLink: "https://maps.app.goo.gl/CozyDanang", checkIn: "14:00", checkOut: "12:00" },
                { name: "Lantana Boutique Hoi An Hotel", dates: "2/2 - 2/4 (2æ™š)", location: "æœƒå®‰", note: "ä½æ–¼æ²³å²¸ï¼Œé™„æ—©é¤ï¼Œæœ‰æµ´ç¼¸ã€‚", mapLink: "https://www.agoda.com/sl/YSFc1TtZRCI", checkIn: "14:00", checkOut: "12:00" }
            ],
            days: [
                { day: 1, date: "1/29 (å››)", title: "æŠµé”å³´æ¸¯" },
                { day: 2, date: "1/30 (äº”)", title: "å·´æ‹¿å±±ä¸€æ—¥éŠ" },
                { day: 3, date: "1/31 (å…­)", title: "äº”è¡Œå±± & è³¼ç‰©" },
                { day: 4, date: "2/1 (æ—¥)", title: "é †åŒ–çš‡åŸå¤éƒ½" },
                { day: 5, date: "2/2 (ä¸€)", title: "è¿¦å—å³¶ & æœƒå®‰" },
                { day: 6, date: "2/3 (äºŒ)", title: "ç¾å±±è–åœ° & å¤åŸ" },
                { day: 7, date: "2/4 (ä¸‰)", title: "è¿”ç¨‹" }
            ],
            // charter: æ¨™è¨˜è©²é …ç›®æ˜¯å¦åœ¨åŒ…è»Šç¯„åœå…§
            activities: [
                // Day 1
                { dayId: 1, time: "17:25", title: "âœˆï¸ é£›æ©Ÿèˆªè¡Œ", desc: "å°ç£è™èˆª IT551\nç™»æ©Ÿé–€B1R(æ¡ƒåœ’T1 -> å³´æ¸¯)\næ©Ÿä¸Šæœ‰ä¾›é¤ã€‚", type: "flight" },
                { dayId: 1, time: "19:10", title: "ğŸ›¬ å…¥å¢ƒé ˜è¡Œæ", desc: "å³´æ¸¯æ©Ÿå ´å…¥å¢ƒå¤§å»³ã€‚", type: "activity", map: "https://www.google.com/maps/search/?api=1&query=Da+Nang+Airport" },
                { dayId: 1, time: "19:40", title: "ğŸš— å‰å¾€å¸‚å€", desc: "é ç´„æ¥é€ (16äººåº§è»Š) å‰å¾€å¸‚å€ã€‚", type: "transport", tag: "é ç´„æ¥é€" },
                { dayId: 1, time: "20:00", title: "ğŸ’° æ©Ÿå ´æ›åŒ¯", desc: "å…ˆåœ¨æ©Ÿå ´æ›å°‘é‡è¶Šå—ç›¾ã€‚\nâš ï¸ æ³¨æ„ï¼šæ©Ÿå ´åŒ¯ç‡å¯èƒ½è¼ƒå·®ï¼Œä¸”æ«ƒæª¯å¤šåœ¨ 20:00 å·¦å³é—œé–‰ï¼Œè‹¥ä¾†ä¸åŠè«‹æ”¹è‡³å¸‚å€ã€‚", type: "activity", important: true },
                { dayId: 1, time: "20:30", title: "ğŸ¨ Check-in", desc: "<a href='https://www.google.com/maps/search/?api=1&query=Cozy+Danang+Boutique+Hotel' target='_blank'>Cozy Danang Boutique Hotel</a>\næ”¾ç½®è¡Œæã€‚", type: "hotel", map: "Cozy Danang Boutique Hotel" },
                { dayId: 1, time: "21:00", title: "ğŸœ æ™šé¤ï¼šåŠŸå¤«éºµ", desc: "<a href='https://www.google.com/maps/search/?api=1&query=Kungfu+Noodle+Restaurant+Danang' target='_blank'>Kungfu Noodle Restaurant</a> (ç‡Ÿæ¥­è‡³ 21:30)ã€‚\nç¶²å‹æ¨è–¦ï¼šç‰›è‚‰éºµã€å»£å—éºµ (å¹³åƒ¹å¥½åƒ)ã€‚", type: "food", map: "Kungfu Noodle Restaurant" },
                { dayId: 1, time: "22:00", title: "ğŸ›Œ å›é£¯åº—ä¼‘æ¯", desc: "<a href='https://www.google.com/maps/search/?api=1&query=Cozy+Danang+Boutique+Hotel' target='_blank'>Cozy Danang Boutique Hotel</a>ã€‚", type: "hotel" },
                
                // Day 2
                { dayId: 2, time: "07:00", title: "ğŸ¥£ æ—©é¤ï¼šé£¯åº—", desc: "é£¯åº—æ—©é¤ (ä¾›æ‡‰æ™‚é–“ 06:30-10:00)ã€‚", type: "food" },
                { dayId: 2, time: "07:30", title: "ğŸšŒ å‰å¾€å·´æ‹¿å±±", desc: "KKday æ¥é€ (è«‹åœ¨é£¯åº—å¤§å»³ç­‰å€™)ã€‚\nâš ï¸ é‡è¦ï¼šå±±ä¸Šæ°£æº«ä½ 5-10 åº¦ï¼Œå‹™å¿…å¸¶å¤–å¥—å’Œé›¨å…·ã€‚", type: "transport", tag: "KKday æ¥é€", important: true },
                { dayId: 2, time: "08:30", title: "ğŸš  çºœè»Š & é»ƒé‡‘ä½›æ‰‹æ©‹", desc: "æ­ä¹˜çºœè»Šä¸Šå±±ã€‚\nåƒè§€ï¼šä½›æ‰‹æ©‹ã€æ„›æƒ…èŠ±åœ’ã€é»›è²é…’çª–ã€‚", type: "activity", map: "Golden Bridge Da Nang" },
                { dayId: 2, time: "12:30", title: "ğŸ” åˆé¤ï¼šå±±ä¸Šå°åƒ", desc: "å»ºè­°åœ¨å±±ä¸Šæ”¤è²©æˆ– Buffet è§£æ±ºã€‚\n(é€£çµç‚ºåœ°åœ–ä½ç½®)", type: "food", map: "Ba Na Hills Sun World" },
                { dayId: 2, time: "14:00", title: "ğŸ° æ³•åœ‹æ‘ & æ¨‚åœ’", desc: "éŠè¦½æ³•åœ‹æ‘æ‹ç…§ã€‚\nFantasy Parkï¼šå®¤å…§éŠæ¨‚åœ’ï¼Œéå±±è»Š (ç´„ 124 TWD)ã€‚", type: "activity" },
                { dayId: 2, time: "16:30", title: "ğŸšŒ ä¸‹å±± & è¿”å›å¸‚å€", desc: "æ­çºœè»Šä¸‹å±±ï¼Œæ­ä¹˜æ¥é€è»Šè¿”å›å³´æ¸¯å¸‚å€ã€‚", type: "transport", tag: "KKday æ¥é€" },
                { dayId: 2, time: "18:30", title: "ğŸ’° è£œæ›åŒ¯", desc: "å‰å¾€æ¼¢å¸‚å ´å‘¨é‚ŠéŠ€æ¨“è£œæ›è¶Šå—ç›¾ã€‚", type: "activity", map: "Han Market Gold Shop" },
                { dayId: 2, time: "19:00", title: "ğŸ¦ æ™šé¤ï¼šéŸ“æ±Ÿç•”/æµ·é®®", desc: "å»ºè­°ï¼šéŸ“æ±Ÿé‚Šé¤å»³ç”¨é¤ (æ™¯è§€æˆ–æµ·é®®)ã€‚\né¤å¾Œå¯æ­¥è¡Œè‡³é¾æ©‹ã€‚", type: "food" },
                { dayId: 2, time: "20:30", title: "ğŸ‰ é¾æ©‹å™´ç«ç§€", desc: "âš ï¸ å™´ç«æ™‚é–“ç´„ 15 åˆ†é˜ã€‚\nè¨˜å¾—ç«™åœ¨ã€Œé€†é¢¨è™•ã€é¿å…è¢«æ°´å™´æ¿•ã€‚", type: "activity", important: true, map: "Dragon Bridge Da Nang" },
                { dayId: 2, time: "21:30", title: "ğŸ›Œ å›é£¯åº—ä¼‘æ¯", desc: "Cozy Danang Boutique Hotelã€‚", type: "hotel" },

                // Day 3
                { dayId: 3, time: "08:00", title: "ğŸ¥£ æ—©é¤ï¼šé£¯åº—", desc: "é£¯åº—æ—©é¤ã€‚", type: "food" },
                { dayId: 3, time: "09:00", title: "ğŸš— å‰å¾€äº”è¡Œå±±", desc: "å«è»Šå‰å¾€æ°´å±±é›»æ¢¯å”®ç¥¨å£ã€‚", type: "transport", tag: "Grab ä¸ƒäººåº§" },
                { dayId: 3, time: "09:30", title: "â›°ï¸ äº”è¡Œå±±", desc: "å»ºè­°ï¼šé›»æ¢¯ä¸Šå±±ï¼Œèµ°ä¸‹å±± (ç´„10min)ã€‚\nåƒè§€éˆæ‡‰å¯ºã€ç„ç©ºæ´ã€‚", type: "activity", map: "Marble Mountains" },
                { dayId: 3, time: "12:00", title: "ğŸ¥¢ åˆé¤ï¼šThÃ¬a Gá»—", desc: "ç±³å…¶æ—æ¨è–¦è¶Šå—æ–™ç† (ç‡Ÿæ¥­ 10:00-22:00)ã€‚", type: "food", map: "ThÃ¬a Gá»— Da Nang" },
                { dayId: 3, time: "14:00", title: "ğŸ›ï¸ æ¼¢å¸‚å ´ & ç²‰ç´…æ•™å ‚", desc: "æ¼¢å¸‚å ´ (Han Market)ï¼š\n1F ä¼´æ‰‹ç¦®/ä¹¾è²¨ï¼Œ2F è¡£æœé‹å­ã€‚\nå‘¨é‚Šé‡‘é£¾åº—å¯è£œæ›åŒ¯ã€‚", type: "shopping", map: "Han Market" },
                { 
                  dayId: 3, 
                  time: "17:00", 
                  title: "ğŸ¦ æ™šé¤ï¼šAll Seasons", 
                  desc: "All Seasons Buffet Da Nangã€‚\nâš ï¸ å·²é è¨‚ 5 ä½é¾è¦åƒåˆ°é£½ï¼Œç¾å ´ä»˜è²» (<a href='https://github.com/Wantinghsu/vngo/blob/main/lobster.png?raw=true' target='_blank'>è¨‚ä½ç…§ç‰‡</a>)ã€‚\n(850k VND++/äººï¼Œä¸å«ç¨…èˆ‡é£²å“)ã€‚", 
                  type: "food", 
                  important: true, 
                  map: "All Seasons Restaurant" 
                },
                { dayId: 3, time: "20:00", title: "ğŸ’†â€â™€ï¸ æŒ‰æ‘© SPA", desc: "HÆ°Æ¡ng TrÃ m Spa (å¯é ç´„)ã€‚\næˆ–åœ¨ç¾æºªæ²™ç˜å‘¨é‚Šæ•£æ­¥ã€‚", type: "activity", map: "HÆ°Æ¡ng TrÃ m Spa Da Nang" },
                { dayId: 3, time: "22:00", title: "ğŸ›Œ å›é£¯åº—ä¼‘æ¯", desc: "Cozy Danang Boutique Hotelã€‚", type: "hotel" },

                // Day 4
                { dayId: 4, time: "07:30", title: "ğŸ¥£ æ—©é¤ï¼šé£¯åº—", desc: "é£¯åº—æ—©é¤ï¼Œåƒé£½æº–å‚™é•·é€”è»Šç¨‹ã€‚", type: "food" },
                { dayId: 4, time: "09:00", title: "ğŸš— å‰å¾€é †åŒ– (åŒ…è»Š)", desc: "KLOOK åŒ…è»Š 12å°æ™‚ã€‚\né€”ç¶“ï¼šæµ·é›²é—œéš˜å£ã€é™µå§‘ç£ (äººç”Ÿå¿…å»50æ™¯é»)ã€‚", type: "transport", tag: "KLOOK åŒ…è»Š (12å°æ™‚)", charter: true, map: "Hai Van Pass" },
                { dayId: 4, time: "11:30", title: "ğŸœ åˆé¤ï¼šé †åŒ–æ–™ç†", desc: "æ¨è–¦ï¼šMadame Thu æˆ– Quan Hanhã€‚\nå¿…åƒï¼šé †åŒ–ç‰›è‚‰ç²‰ (Bun Bo Hue)ã€æµ®èé¤…ã€‚", type: "food", charter: true, map: "Madame Thu Restaurant - Hue" },
                { dayId: 4, time: "12:30", title: "ğŸ¯ é †åŒ–çš‡åŸ", desc: "è¶Šå—ç¸®å°ç‰ˆç´«ç¦åŸï¼Œåƒè§€ç´„ 2Hã€‚", type: "activity", charter: true, map: "Hue Imperial City" },
                { dayId: 4, time: "15:00", title: "ğŸ›ï¸ å•Ÿå®šçš‡é™µ / å¤©å§¥å¯º", desc: "ä¸»è¡Œç¨‹ï¼šå•Ÿå®šçš‡é™µ (èåˆæ±è¥¿æ–¹å»ºç¯‰)ã€‚\nå‚™æ¡ˆï¼šå¤©å§¥å¯º (Thien Mu Pagoda) è‹¥æ™‚é–“å……è£•å¯å»ã€‚", type: "activity", charter: true, map: "Tomb of Khai Dinh" },
                { dayId: 4, time: "16:00", title: "ğŸš— è¿”å›å³´æ¸¯", desc: "è»Šç¨‹ç´„ 2 å°æ™‚ï¼Œç¶“æµ·é›²éš§é“è¿”å›ã€‚", type: "transport", charter: true },
                { dayId: 4, time: "18:00", title: "ğŸ¢ æ™šé¤ï¼šå±±èŒ¶å¤œå¸‚", desc: "çƒ¤é¾è¦ã€æµ·é®®ç›¤ã€è¶Šå¼ç…é¤…ã€‚\nâš ï¸ å‚™è¨»ï¼šè‹¥æ“”å¿ƒæµ·é®®ä¸æ–°é®®ï¼Œå¯ç´”é€›è¡—ï¼Œåƒåˆ¥çš„ã€‚", type: "food", map: "Son Tra Night Market" },
                { dayId: 4, time: "20:30", title: "ğŸ‰ é¾æ©‹å™´ç« (å‚™æ¡ˆ)", desc: "æ¯é€±äº”ã€å…­ã€æ—¥ 21:00 å™´ç«ã€‚\nè‹¥ Day 2 æ²’çœ‹åˆ°ï¼Œä»Šæ™šå¯è£œçœ‹ã€‚", type: "activity", important: true },
                { dayId: 4, time: "22:00", title: "ğŸ›Œ å›é£¯åº—ä¼‘æ¯", desc: "Cozy Danang Boutique Hotel (æœ€å¾Œä¸€æ™š)ã€‚", type: "hotel" },

                // Day 5
                { dayId: 5, time: "07:30", title: "ğŸ¥£ æ—©é¤ï¼šé£¯åº—", desc: "é£¯åº—æ—©é¤ã€‚\nç”¨é¤å¾Œæ•´ç†è¡Œæé€€æˆ¿ã€‚", type: "food" },
                { dayId: 5, time: "09:00", title: "ğŸš— å‰å¾€è¿¦å—å³¶", desc: "å¸¶è‘—è¡Œæç§»å‹•ï¼ŒåŒ…è»Šå‰å¾€ã€‚", type: "transport", tag: "KLOOK åŒ…è»Š (4å°æ™‚)", charter: true },
                { dayId: 5, time: "10:00", title: "ğŸ¥¥ è¿¦å—å³¶ç«¹ç±ƒèˆ¹", desc: "é«”é©—å‚³çµ±æ¡¶èˆ¹æ—‹è½‰è¡¨æ¼” (ç´„1å°æ™‚)ã€‚\nâš ï¸ èˆ¹å¤«å°è²»ç´„ 20,000-50,000 VNDã€‚", type: "activity", important: true, charter: true },
                { dayId: 5, time: "11:00", title: "ğŸ² åˆé¤ï¼šNhÃ  hÃ ng BÃ´ng Dá»«a", desc: "BÃ´ng Dá»«a Restaurantã€‚\nç‰¹è‰²ï¼šæµ·é®®ç«é‹ã€çƒ¤è¦ã€ç‚’ç©ºå¿ƒèœã€‚", type: "food", charter: true, map: "NhÃ  hÃ ng BÃ´ng Dá»«a Hoi An" },
                { dayId: 5, time: "12:30", title: "ğŸ¨ å‰å¾€æœƒå®‰ & Check-in", desc: "åŒ…è»ŠçµæŸï¼Œå‰å¾€ Lantana Boutique Hoi An Hotel æ”¾è¡Œæã€‚", type: "hotel", charter: true, map: "Lantana Boutique Hoi An Hotel" },
                { dayId: 5, time: "13:00", title: "ğŸ® æœƒå®‰å¤åŸæ¼«éŠ", desc: "æ™¯é»ï¼šæ—¥æœ¬æ©‹ã€ç¦å»ºæœƒé¤¨ã€‚\nä¸‹åˆèŒ¶ï¼šMot Hoi An (è·èŠ±èŒ¶)ã€Faifo Coffee (é ‚æ¨“æ™¯)ã€‚", type: "activity", map: "Hoi An Ancient Town" },
                { dayId: 5, time: "16:00", title: "ğŸ¡ å‰å¾€æœƒå®‰å°è±¡æ¨‚åœ’", desc: "16:00å…¥åœ’(KKDAYæ›ç¥¨)\n\nã€Šè©³ç´°æ´»å‹•æµç¨‹ã€‹\n16:30 - 17:30ï½œåœ’å€æ¼«æ­¥ & è§€è³è¿è³“ç§€ (Mini Shows)ï¼šè¿è¦ªéšŠä¼ã€å¤ä»£å•†è²¿å ´æ™¯\n17:30 - 18:45ï½œæ™šé¤ï¼šNÃ³n LÃ¡ (æ–—ç¬ ) é¤å»³è‡ªåŠ©é¤\n18:45 - 19:30ï½œå¤œæ™¯ & ç‰¹è‰²å°ç§€ï¼ˆè¡—é“å¾Œæ®µæœ‰ ã€Šç‰è¯å…¬ä¸»å¤§å©šã€‹ã€ã€Šæ¯”æ­¦æ‹›è¦ªã€‹ï¼‰\n19:30 - 19:50ï½œå‰å¾€åŠ‡å ´ & VIP å°Šæ¦®å…¥å ´ ï¼šè©¢å•å·¥ä½œäººå“¡ \"VIP Elevator\"\n20:00 - 21:00ï½œã€Šæœƒå®‰å›æ†¶ã€‹å¯¦æ™¯ç§€ (Main Show)\n\nâš ï¸ æ•£å ´æŠ€å·§ï¼šVIP é›¢å ´é€šå¸¸ä¹Ÿæ¯”è¼ƒå¿«ï¼ˆæœ‰ç¨ç«‹é€šé“ï¼‰ã€‚èµ°å‡ºåŠ‡å ´å¾Œï¼Œå»ºè­°å¿«é€Ÿé€šéæ©‹ï¼Œèµ°åˆ°åœ’å€å¤§é–€å¤–çš„é¦¬è·¯é‚Šã€‚æ‰“é–‹ Grab å®šä½åœ¨ \"Hoi An Impression Theme Park Gate\"ã€‚", type: "activity" },
                { dayId: 5, time: "21:30", title: "ğŸ›Œ å›é£¯åº—ä¼‘æ¯", desc: "Lantana Boutique Hoi An Hotelã€‚", type: "hotel" },

                // Day 6
                { dayId: 6, time: "07:30", title: "ğŸ¥£ æ—©é¤ï¼šé£¯åº—", desc: "é£¯åº—æ—©é¤ã€‚", type: "food" },
                { dayId: 6, time: "09:00", title: "ğŸš— å‰å¾€ç¾å±±è–åœ°", desc: "è»Šç¨‹ç´„ 1 å°æ™‚ã€‚", type: "transport", tag: "KLOOK åŒ…è»Š (4å°æ™‚)", charter: true },
                { dayId: 6, time: "10:00", title: "ğŸ›• ç¾å±±è–åœ°", desc: "åƒè§€å å©†ç‹åœ‹éºå€ (å°å³å“¥çªŸ)ã€‚\næœ‰æ¥é§è»Šèˆ‡èˆè¹ˆè¡¨æ¼”ã€‚", type: "activity", map: "My Son Sanctuary", charter: true },
                { dayId: 6, time: "12:00", title: "ğŸš— è¿”å›æœƒå®‰", desc: "æ­è»Šè¿”å›æœƒå®‰å¸‚å€ (ç´„1å°æ™‚)ã€‚", type: "transport", charter: true },
                { dayId: 6, time: "13:00", title: "ğŸ›ï¸ å¤åŸé€›è¡— & ä¸‹åˆèŒ¶", desc: "é€›è¡—ã€åˆé¤ã€è¶Šå¼ä¸‹åˆèŒ¶ã€‚\næ¨è–¦ï¼š\n1. Faifo Coffee (é ‚æ¨“å¯æ‹åˆ°å¤é®å±‹é ‚å…¨æ™¯)\n2. MÃ³t Hoi An (å¿…å–çš„è“®èŠ±è—¥è‰èŒ¶)", type: "shopping", map: "Faifo Coffee" },
                { dayId: 6, time: "17:00", title: "ğŸ¥¢ æ™šé¤ï¼šç¶“å…¸è¶Šå¼", desc: "Morning Glory æˆ– Miss Lyã€‚\nå¿…é»æœƒå®‰ä¸‰å¯¶ï¼š\n1. ç™½ç«ç‘° (White Rose)\n2. ç‚¸é›²å\n3. é«˜æ¨“éºµ (Cao Lau)", type: "food", map: "Morning Glory Original" },
                { dayId: 6, time: "18:30", title: "ğŸ•¯ï¸ ç§‹ç›†æ²³æ”¾æ°´ç‡ˆ", desc: "èµ°åˆ°å®‰æœƒæ©‹ (An Hoi Bridge)ï¼Œæ­ä¹˜èˆ¢èˆ¨èˆ¹é«”é©—æ”¾æ°´ç‡ˆ (Lantern Release)ã€‚", type: "activity", map: "An Hoi Bridge" },
                { dayId: 6, time: "19:30", title: "ğŸ® æœƒå®‰å¤œå¸‚", desc: "ç‡ˆç± è¡—ã€æ‰‹å·¥è—å“ã€ç«¹ç·¨åŒ…ã€‚\nè¡—é ­å°åƒæ¨è–¦ï¼šé¦™è•‰ç…é¤…ã€çƒ¤è‚‰ä¸²ã€‚", type: "shopping", map: "Hoi An Night Market" },
                { dayId: 6, time: "21:00", title: "ğŸ›Œ å›é£¯åº—ä¼‘æ¯", desc: "Lantana Boutique Hoi An Hotelã€‚", type: "hotel" },

                // Day 7
                { dayId: 7, time: "06:30", title: "ğŸ¥£ æ—©é¤ï¼šé£¯åº—", desc: "é£¯åº—ç°¡æ˜“æ—©é¤ / è¾¦ç†é€€æˆ¿ã€‚", type: "food" },
                { dayId: 7, time: "07:00", title: "ğŸšŒ å‰å¾€å³´æ¸¯æ©Ÿå ´", desc: "å¾æœƒå®‰å‡ºç™¼ï¼Œé ç•™è»Šç¨‹æ™‚é–“ã€‚\n(KKday æ¥é€)", type: "transport", tag: "KKday æ¥é€" },
                { dayId: 7, time: "08:00", title: "ğŸ›« æ©Ÿå ´å ±åˆ°", desc: "è¾¦ç†ç™»æ©Ÿã€æœ€å¾Œå…ç¨…åº—æ¡è²·ã€‚", type: "activity" },
                { dayId: 7, time: "10:20", title: "âœˆï¸ é£›æ©Ÿè¿”ç¨‹", desc: "è¯èˆª CI788 (å³´æ¸¯ T2 -> æ¡ƒåœ’ T1)ã€‚\n14:05 æŠµé”å°ç£ã€‚", type: "flight" }
            ]
        };

        // --- Logic ---
        let currentDayId = 1;
        let exchangeRate = 770; // é è¨­åŒ¯ç‡

        window.addEventListener('DOMContentLoaded', () => {
            try {
                renderDaySelector();
                renderItinerary(currentDayId);
                renderFlights();
                renderHotels();
                renderMustBuy(); 
                document.getElementById('loading-msg').style.display = 'none';
                
                // è¨­å®šæ—¥æœŸé è¨­ç‚ºä»Šå¤©
                document.getElementById('acc-date').valueAsDate = new Date();

                // åˆå§‹åŒ–åŒ¯ç‡
                fetchExchangeRate();
            } catch (err) {
                document.getElementById('loading-msg').innerHTML = `<span class="text-red-500">Error: ${err.message}</span>`;
            }
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${tabName}`).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-teal-600');
                btn.classList.add('text-gray-400');
            });
            document.getElementById(`btn-${tabName}`).classList.remove('text-gray-400');
            document.getElementById(`btn-${tabName}`).classList.add('text-teal-600');

            // å¦‚æœåˆ‡æ›åˆ°åˆ†å¸³é é¢ï¼Œè‡ªå‹•è®€å–æœ€æ–°å¸³ç›®
            if(tabName === 'accounting') {
                fetchExpenses();
            }
        }

        function selectDay(dayId) {
            currentDayId = dayId;
            renderDaySelector();
            renderItinerary(dayId);
            document.getElementById('app-container').scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderDaySelector() {
            const container = document.getElementById('day-selector');
            container.innerHTML = DATA.days.map(d => {
                const isActive = d.day === currentDayId;
                const activeClass = isActive ? 'bg-teal-600 text-white shadow-md transform scale-105' : 'bg-white text-gray-500 border border-gray-100';
                return `<button onclick="selectDay(${d.day})" class="flex-none flex flex-col items-center justify-center min-w-[3.8rem] py-2 rounded-xl transition-all duration-200 ${activeClass}">
                        <span class="text-[10px] font-medium opacity-90">Day ${d.day}</span>
                        <span class="text-sm font-bold">${d.date.split('(')[0]}</span>
                    </button>`;
            }).join('');
        }

        function renderItinerary(dayId) {
            const list = document.getElementById('itinerary-list');
            const dayData = DATA.days.find(d => d.day === dayId);
            const items = DATA.activities.filter(a => a.dayId === dayId);

            let html = `
                <div class="mb-4 px-1">
                    <h2 class="text-2xl font-bold text-gray-800">${dayData.title}</h2>
                    <p class="text-sm text-gray-500 mt-1 flex items-center gap-1">${dayData.date}</p>
                </div>
            `;

            if (items.length === 0) {
                html += `<div class="p-8 text-center text-gray-400 bg-white rounded-xl border border-dashed border-gray-300">æœ¬æ—¥ç„¡ç‰¹å®šè¡Œç¨‹</div>`;
            } else {
                html += items.map((item, index) => {
                    const isLast = index === items.length - 1;
                    const typeColor = getTypeColor(item.type);
                    const typeIcon = getTypeIcon(item.type);
                    const transportBadge = item.tag ? `<div class="bg-blue-50 px-3 py-1.5 border-b border-blue-100 flex items-center gap-1 text-xs font-bold text-blue-700">${item.tag}</div>` : '';
                    
                    const charterClass = item.charter ? 'border-2 border-l-4 border-blue-200 bg-blue-50/20' : '';
                    const importantStyle = ''; 
                    const finalStyle = item.charter ? charterClass : importantStyle;

                    const mapBtn = item.map ? `
                        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.map)}" target="_blank" onclick="event.stopPropagation()" class="p-2 bg-gray-100 rounded-full text-gray-500 hover:text-teal-600 hover:bg-teal-50 transition-colors shadow-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        </a>
                    ` : '';
                    
                    const needToggle = item.desc.length > 30; 
                    const toggleIndicator = needToggle ? `
                        <div class="text-xs text-gray-400 mt-2 flex items-center gap-1 opacity-70">
                            <svg class="w-3 h-3 transition-transform duration-300 toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            <span class="toggle-text">å±•é–‹è©³æƒ…</span>
                        </div>
                    ` : '';

                    return `
                    <div class="relative pl-4">
                        ${!isLast ? '<div class="timeline-line"></div>' : ''}
                        <div class="relative bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mb-5 transition-all active:scale-[0.99] ${finalStyle}">
                            ${transportBadge}
                            <div class="p-4 flex gap-4" onclick="toggleDesc(this)">
                                <div class="flex flex-col items-center gap-1 min-w-[3.5rem] pt-1">
                                    <span class="text-sm font-black text-gray-700 tracking-tight">${item.time}</span>
                                    <div class="w-9 h-9 rounded-full flex items-center justify-center text-white shadow-md z-10" style="background-color: ${typeColor}">
                                        ${typeIcon}
                                    </div>
                                </div>
                                <div class="flex-1 min-w-0 pt-1">
                                    <div class="flex justify-between items-start">
                                        <h3 class="text-lg font-bold text-gray-800 leading-snug">${item.title}</h3>
                                        <div class="flex gap-2 shrink-0 ml-2">
                                            ${item.important ? '<span class="text-gray-500 text-lg" title="é‡è¦æé†’">âš ï¸</span>' : ''}
                                            ${mapBtn}
                                        </div>
                                    </div>
                                    <div class="mt-1 text-sm text-gray-600 desc-text leading-relaxed">${item.desc}</div>
                                    ${toggleIndicator}
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
            }
            list.innerHTML = html;
        }

        // æ¸²æŸ“å¿…è²·æ¸…å–®
        function renderMustBuy() {
            const container = document.getElementById('mustbuy-list');
            container.innerHTML = DATA.shopping.map(item => `
                <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    ${item.image ? `<div class="mb-3 rounded-lg overflow-hidden h-48 bg-gray-100 relative">
                        <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover" loading="lazy">
                    </div>` : ''}

                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-teal-800">${item.name}</h3>
                        <span class="bg-rose-100 text-rose-600 text-xs font-bold px-2 py-1 rounded-full whitespace-nowrap ml-2">${item.highlight}</span>
                    </div>
                    <div class="text-sm text-gray-600 leading-relaxed whitespace-pre-wrap">${item.desc}</div>
                </div>
            `).join('');
        }

        function renderFlights() {
            const container = document.getElementById('view-flights');
            container.innerHTML = DATA.flights.map(f => `
                <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100 relative overflow-hidden mb-4">
                    <div class="absolute top-0 right-0 bg-blue-600 text-white text-xs px-3 py-1 rounded-bl-lg font-bold">${f.type}</div>
                    <div class="text-xs text-gray-500 font-bold mb-2">${f.date}</div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-center">
                            <div class="text-3xl font-black text-gray-800">${f.time.split('-')[0].trim()}</div>
                            <div class="text-xs text-gray-500 mt-1">${f.from}</div>
                        </div>
                        <div class="flex-1 flex flex-col items-center px-4">
                             <div class="text-xs text-blue-600 font-bold mb-1">${f.airline}</div>
                             <div class="w-full h-[1px] bg-gray-300 relative flex items-center justify-center"></div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-black text-gray-800">${f.time.split('-')[1].trim()}</div>
                            <div class="text-xs text-gray-500 mt-1">${f.to}</div>
                        </div>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg text-xs text-blue-800 border border-blue-100">${f.note}</div>
                </div>
            `).join('');
        }

        function renderHotels() {
            const container = document.getElementById('view-hotels');
            container.innerHTML = DATA.hotels.map(h => `
                <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100 mb-4">
                    <div class="flex justify-between items-start mb-3">
                        <span class="bg-purple-100 text-purple-700 text-xs font-bold px-2 py-1 rounded">${h.location}</span>
                        <span class="text-xs text-gray-400 font-medium">${h.dates}</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2 leading-tight">${h.name}</h3>
                    <div class="flex items-center gap-2 text-xs text-gray-500 mb-4 bg-gray-50 p-2 rounded w-fit">
                        <span>In ${h.checkIn} / Out ${h.checkOut}</span>
                    </div>
                    <div class="text-sm text-gray-600 p-3 rounded border border-gray-100 mb-4 whitespace-pre-wrap leading-relaxed">${h.note}</div>
                    <div class="grid grid-cols-2 gap-3">
                        <a href="${h.mapLink}" target="_blank" class="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-xl text-sm font-medium transition-colors">ğŸ“ åœ°åœ–</a>
                        <button onclick="copyText('${h.name}')" class="flex items-center justify-center gap-2 bg-purple-50 hover:bg-purple-100 text-purple-700 py-3 rounded-xl text-sm font-medium transition-colors">ğŸ“‹ è¤‡è£½</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleDesc(el) {
            const desc = el.querySelector('.desc-text');
            const icon = el.querySelector('.toggle-icon');
            const text = el.querySelector('.toggle-text');
            if(desc) {
                desc.classList.toggle('expanded');
                if (desc.classList.contains('expanded')) {
                    if(icon) icon.style.transform = 'rotate(180deg)';
                    if(text) text.innerText = 'æ”¶èµ·';
                } else {
                    if(icon) icon.style.transform = 'rotate(0deg)';
                    if(text) text.innerText = 'å±•é–‹è©³æƒ…';
                }
            }
        }

        function copyText(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('å·²è¤‡è£½: ' + text);
            } catch (err) {
                alert('è¤‡è£½å¤±æ•—');
            }
            document.body.removeChild(textArea);
        }

        function getTypeColor(type) {
            switch(type) {
                case 'transport': return '#3b82f6';
                case 'flight': return '#2563eb';
                case 'hotel': return '#a855f7';
                case 'food': return '#f97316';
                case 'shopping': return '#ec4899';
                default: return '#10b981';
            }
        }

        function getTypeIcon(type) {
            const icons = {
                transport: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>',
                flight: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>',
                hotel: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m8-2a2 2 0 100-4 2 2 0 000 4zm-6-4a2 2 0 110-4 2 2 0 010 4zm6-10a2 2 0 110-4 2 2 0 010 4zm-6 4a2 2 0 110-4 2 2 0 010 4z"></path></svg>',
                food: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>', 
                shopping: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>',
                activity: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'
            };
            return icons[type] || icons.activity;
        }

        // ==========================
        // åŒ¯ç‡è¨ˆç®—æ©Ÿé‚è¼¯
        // ==========================
        const vndInput = document.getElementById('input-vnd');
        const twdInput = document.getElementById('input-twd');
        const rateDisplay = document.getElementById('display-rate');
        const statusBadge = document.getElementById('rate-status');

        function toggleCalc() {
            const modal = document.getElementById('calc-modal');
            if (modal.classList.contains('hidden-modal')) {
                modal.classList.remove('hidden-modal');
                modal.classList.add('show-modal');
            } else {
                modal.classList.remove('show-modal');
                modal.classList.add('hidden-modal');
            }
        }

        async function fetchExchangeRate() {
            try {
                // ä½¿ç”¨å…è²» API ç²å– TWD åŒ¯ç‡
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/TWD');
                const data = await res.json();
                
                if (data && data.rates && data.rates.VND) {
                    exchangeRate = data.rates.VND;
                    rateDisplay.innerText = Math.floor(exchangeRate); // é¡¯ç¤ºæ•´æ•¸
                    statusBadge.innerText = "å³æ™‚åŒ¯ç‡";
                    statusBadge.className = "text-[10px] bg-green-600 px-2 py-0.5 rounded-full font-normal";
                    updateRateDisplay(); // å¦‚æœæ­£åœ¨åˆ†å¸³é é¢ï¼Œé †ä¾¿æ›´æ–°æç¤º
                } else {
                    throw new Error("No rate data");
                }
            } catch (e) {
                console.log("ä½¿ç”¨é è¨­åŒ¯ç‡", e);
                rateDisplay.innerText = exchangeRate;
                statusBadge.innerText = "é è¨­åŒ¯ç‡";
                statusBadge.className = "text-[10px] bg-gray-500 px-2 py-0.5 rounded-full font-normal";
            }
        }

        // ç›£è½ VND è¼¸å…¥ -> æ›ç®— TWD
        vndInput.addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            if (!isNaN(val)) {
                // ä¿®æ­£ï¼šè¶Šå—ç›¾æ›å›å°å¹£æ˜¯é™¤æ³•
                twdInput.value = (val / exchangeRate).toFixed(1);
            } else {
                twdInput.value = '';
            }
        });

        // ç›£è½ TWD è¼¸å…¥ -> æ›ç®— VND
        twdInput.addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            if (!isNaN(val)) {
                // å°å¹£æ›è¶Šå—ç›¾æ˜¯ä¹˜æ³•
                vndInput.value = Math.floor(val * exchangeRate);
            } else {
                vndInput.value = '';
            }
        });

        // ==========================
        // è¨˜å¸³ & GAS ä¸²æ¥é‚è¼¯
        // ==========================
        
        function updateRateDisplay() {
            const currency = document.getElementById('acc-currency').value;
            const hint = document.getElementById('acc-rate-hint');
            if (currency === 'TWD') {
                hint.innerText = 'ä»¥ 1:1 è¨ˆç®—';
            } else {
                hint.innerText = `ç•¶å‰åŒ¯ç‡: 1 TWD â‰ˆ ${Math.floor(exchangeRate)} VND`;
            }
        }

        async function submitExpense(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-submit-acc');
            const originalText = btn.innerHTML;
            
            // æª¢æŸ¥æ˜¯å¦å·²è¨­å®š URL
            if(GAS_URL.includes("ä½ çš„_GOOGLE")) {
                alert("è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®š GAS_URLï¼");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg> è™•ç†ä¸­...`;

            const date = document.getElementById('acc-date').value;
            const item = document.getElementById('acc-item').value;
            const payer = document.getElementById('acc-payer').value;
            const currency = document.getElementById('acc-currency').value;
            const amount = document.getElementById('acc-amount').value;
            const note = document.getElementById('acc-note').value;
            const editRowId = document.getElementById('edit-row-id').value; // å–å¾—ç·¨è¼¯ID

            // åˆ¤æ–·æ˜¯ã€Œæ–°å¢ã€é‚„æ˜¯ã€Œç·¨è¼¯ã€
            const action = editRowId ? 'edit' : 'add';
            const payload = {
                action: action,
                row: editRowId ? parseInt(editRowId) : null,
                date: date,
                item: item,
                payer: payer,
                currency: currency,
                amount: amount,
                rate: exchangeRate, // å‚³é€ç•¶ä¸‹åŒ¯ç‡
                note: note
            };

            try {
                await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                
                // æˆåŠŸå¾Œé‡ç½®
                resetFormState();
                
                alert(action === 'edit' ? 'âœ… ä¿®æ”¹æˆåŠŸï¼' : `âœ… è¨˜å¸³æˆåŠŸï¼\n${item} (${currency} ${amount})`);
                fetchExpenses(); // é‡æ–°æ•´ç†åˆ—è¡¨

            } catch (err) {
                console.error(err);
                alert("âŒ è™•ç†å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– URL è¨­å®š");
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // åˆ‡æ›é¡¯ç¤ºçµç®—å€å¡Š
        function toggleSettlement() {
            const detailBox = document.getElementById('settlement-details');
            const arrow = document.getElementById('arrow-settlement');
            
            if (detailBox.classList.contains('open')) {
                detailBox.classList.remove('open');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                detailBox.classList.add('open');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        // === åˆªé™¤åŠŸèƒ½ ===
        async function deleteExpense(rowId, itemName) {
            if (!confirm(`âš ï¸ ç¢ºå®šè¦åˆªé™¤ã€Œ${itemName}ã€å—ï¼Ÿ\n(é€™ç­†è³‡æ–™æœƒå¾è¨ˆç®—ä¸­ç§»é™¤)`)) {
                return;
            }

            try {
                // é¡¯ç¤º loading æç¤º
                const card = document.getElementById(`expense-card-${rowId}`);
                if(card) card.style.opacity = '0.5';

                await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'delete',
                        row: rowId
                    })
                });

                alert('ğŸ—‘ï¸ å·²åˆªé™¤');
                fetchExpenses(); 

            } catch (err) {
                console.error(err);
                alert('âŒ åˆªé™¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯');
                if(card) card.style.opacity = '1';
            }
        }

        // === ç·¨è¼¯åŠŸèƒ½ï¼šå°‡è³‡æ–™å¸¶å…¥è¡¨å–® ===
        function editExpense(data) {
            // å¸¶å…¥è³‡æ–™
            document.getElementById('acc-date').value = data.date.replace(/\//g, '-');
            document.getElementById('acc-item').value = data.item;
            document.getElementById('acc-payer').value = data.payer;
            document.getElementById('acc-currency').value = data.currency;
            document.getElementById('acc-amount').value = data.amount;
            document.getElementById('acc-note').value = data.note;
            
            // è¨­å®šç·¨è¼¯ ID
            document.getElementById('edit-row-id').value = data.rowIndex;

            // æ”¹è®Šä»‹é¢ç‹€æ…‹
            document.getElementById('form-title').innerHTML = `âœï¸ ä¿®æ”¹å¸³ç›® <span class="text-xs text-gray-400 font-normal">#${data.rowIndex}</span>`;
            document.getElementById('btn-submit-acc').innerHTML = 'ç¢ºèªæ›´æ–°';
            document.getElementById('btn-submit-acc').classList.replace('bg-teal-600', 'bg-blue-600');
            document.getElementById('btn-submit-acc').classList.replace('hover:bg-teal-700', 'hover:bg-blue-700');
            document.getElementById('btn-cancel-edit').classList.remove('hidden'); // é¡¯ç¤ºå–æ¶ˆæŒ‰éˆ•
            
            // æ»¾å‹•åˆ°è¡¨å–®
            document.getElementById('app-container').scrollTo({ top: 0, behavior: 'smooth' });
        }

        // === é‡ç½®è¡¨å–®ç‹€æ…‹ (å›åˆ°æ–°å¢æ¨¡å¼) ===
        function resetFormState() {
            document.getElementById('account-form').reset();
            document.getElementById('edit-row-id').value = ''; // æ¸…ç©ºç·¨è¼¯ID
            document.getElementById('acc-date').valueAsDate = new Date(); // æ—¥æœŸå›æ­¸ä»Šå¤©

            document.getElementById('form-title').innerHTML = 'ğŸ’¸ æ–°å¢ä¸€ç­†å¸³ç›®';
            document.getElementById('btn-submit-acc').innerHTML = '<span>è¨˜å¸³</span>';
            document.getElementById('btn-submit-acc').classList.replace('bg-blue-600', 'bg-teal-600');
            document.getElementById('btn-submit-acc').classList.replace('hover:bg-blue-700', 'hover:bg-teal-700');
            document.getElementById('btn-cancel-edit').classList.add('hidden');
        }

        async function fetchExpenses() {
            const listDiv = document.getElementById('expense-list');
            const summaryCard = document.getElementById('expense-summary-card');
            const totalEl = document.getElementById('total-expense');
            const splitListEl = document.getElementById('split-result-list');
            
             if(GAS_URL.includes("ä½ çš„_GOOGLE")) {
                listDiv.innerHTML = `<div class="text-center text-red-400 p-4">è«‹å…ˆè¨­å®š GAS_URL</div>`;
                return;
            }
            
            listDiv.innerHTML = `<div class="text-center text-gray-400 py-4 text-sm animate-pulse">æ­£åœ¨è®€å–é›²ç«¯å¸³ç›®...</div>`;

            // åˆ†å¸³æ¯”ä¾‹è¨­å®š
            const SPLIT_RATIO = {
                'æ¦®': 0.1333,
                'å¦‚': 0.1333,
                'ç¿”': 0.2667,
                'åº­': 0.2667,
                'ä¸­': 0.20
            };

            // ç´€éŒ„æ¯å€‹äººå·²ä»˜æ¬¾é‡‘é¡ (å¢Šä»˜)
            let PAID_TRACKER = {
                'æ¦®': 0, 'å¦‚': 0, 'ç¿”': 0, 'åº­': 0, 'ä¸­': 0
            };

            try {
                const res = await fetch(GAS_URL);
                const data = await res.json();
                
                if (data.length === 0) {
                    listDiv.innerHTML = `<div class="text-center text-gray-400 py-4 text-sm">ç›®å‰æ²’æœ‰å¸³ç›®</div>`;
                    summaryCard.classList.add('hidden');
                    return;
                }

                // è¨ˆç®—ç¸½é‡‘é¡ & çµ±è¨ˆæ¯äººå·²ä»˜
                let totalTWD = 0;
                data.forEach(row => {
                    const amount = parseInt(row.twd);
                    if(!isNaN(amount)) {
                        totalTWD += amount;
                        if (PAID_TRACKER[row.payer] !== undefined) {
                            PAID_TRACKER[row.payer] += amount;
                        }
                    }
                });

                // æ›´æ–°ç¸½çµç®—çœ‹æ¿æ•¸å­—
                totalEl.innerText = totalTWD.toLocaleString();
                
                // è¨ˆç®—çµç®—
                let splitHtml = '';
                for (const [name, ratio] of Object.entries(SPLIT_RATIO)) {
                    const shouldPay = Math.round(totalTWD * ratio); // æ‡‰ä»˜
                    const hasPaid = PAID_TRACKER[name]; // å·²ä»˜
                    const balance = shouldPay - hasPaid; // å·®é¡

                    let balanceText = '';
                    if (balance > 0) {
                        balanceText = `<span class="text-rose-500 font-bold">éœ€æ”¯ä»˜ $${balance.toLocaleString()}</span>`;
                    } else if (balance < 0) {
                        balanceText = `<span class="text-green-600 font-bold">æ‡‰æ‹¿å› $${Math.abs(balance).toLocaleString()}</span>`;
                    } else {
                        balanceText = `<span class="text-gray-400">å·²çµæ¸…</span>`;
                    }

                    splitHtml += `
                        <div class="flex justify-between items-center bg-white p-2 rounded border border-gray-100">
                            <div>
                                <span class="font-bold text-gray-700 mr-2">${name}</span>
                                <span class="text-[10px] text-gray-400">æ‡‰ä»˜$${shouldPay.toLocaleString()} / å·²ä»˜$${hasPaid.toLocaleString()}</span>
                            </div>
                            <div class="text-right text-sm">
                                ${balanceText}
                            </div>
                        </div>
                    `;
                }
                splitListEl.innerHTML = splitHtml;
                summaryCard.classList.remove('hidden');

                // ç”¢ç”Ÿåˆ—è¡¨ HTML (åŠ å…¥ç·¨è¼¯æŒ‰éˆ•)
                const html = data.map(row => {
                    const isTWD = row.currency === 'TWD';
                    const displayTime = row.date ? row.date.replace(/-/g, '/') : row.time; 
                    
                    // å°‡è³‡æ–™è½‰æ›ç‚ºJSONå­—ä¸²ï¼Œä»¥ä¾¿å‚³éçµ¦ç·¨è¼¯å‡½æ•¸ (éœ€è™•ç†å–®å¼•è™Ÿ)
                    const rowDataSafe = JSON.stringify(row).replace(/"/g, '&quot;');

                    return `
                        <div id="expense-card-${row.rowIndex}" class="bg-white border border-gray-100 rounded-xl p-4 shadow-sm flex justify-between items-center relative group">
                            <div>
                                <div class="font-bold text-gray-800 text-sm">${row.item}</div>
                                <div class="text-xs text-gray-500 mt-1 flex items-center gap-2">
                                    <span class="bg-gray-100 px-2 py-0.5 rounded text-gray-600 font-medium">${row.payer}</span>
                                    <span class="opacity-75">${displayTime}</span>
                                </div>
                                ${row.note ? `<div class="text-xs text-gray-400 mt-1">${row.note}</div>` : ''}
                            </div>
                            <div class="text-right flex flex-col items-end">
                                <div class="font-bold text-teal-700 text-lg">$${parseInt(row.twd).toLocaleString()} <span class="text-[10px] text-gray-400 font-normal">TWD</span></div>
                                ${!isTWD ? `<div class="text-xs text-gray-400 mb-1">${parseInt(row.amount).toLocaleString()} ${row.currency}</div>` : ''}
                                
                                <div class="flex gap-2 mt-1">
                                    <button onclick="editExpense(${rowDataSafe})" class="text-xs text-blue-400 hover:text-blue-600 hover:bg-blue-50 px-2 py-1 rounded transition-colors flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                                        ä¿®æ”¹
                                    </button>
                                    <button onclick="deleteExpense(${row.rowIndex}, '${row.item}')" class="text-xs text-red-400 hover:text-red-600 hover:bg-red-50 px-2 py-1 rounded transition-colors flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                        åˆªé™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                listDiv.innerHTML = html;

            } catch (err) {
                console.error(err);
                listDiv.innerHTML = `<div class="text-center text-red-400 py-4 text-sm">è®€å–å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>`;
            }
        }
    </script>
</body>
</html>
